## Antonio Gallego amturing@gmail.com
## Solves the travelman problem using the Simulated Annealing algorithm
## The video that inspired it all: https://www.youtube.com/watch?v=SC5CX8drAtU
## https://en.wikipedia.org/wiki/Simulated_annealing
## http://www.theprojectspot.com/tutorial-post/simulated-annealing-algorithm-for-beginners/6
## https://towardsdatascience.com/how-to-solve-the-traveling-salesman-problem-a-comparative-analysis-39056a916c9f
## DATA from https://www.businessintelligence.info/varios/longitud-latitud-pueblos-espana.html

from random import randint

##CITIES=['B','BI','C','M','MA','S','TO','V','Z']
##NAMES=['Barcelona','Bilbao','Coruña','Madrid','Málaga','Sevilla','Toledo','Valencia','Zaragoza']
##KMt=[[0	,620	,1118	,621	,997	,1046	,692	,349	,296],
##[620	,0	,644	,395	,939	,993	,466	,633	,324],
##[1118	,644	,0	,609	,1153	,947	,675	,961	,833],
##[621	,395	,609	,0	,544	,538	,71	,352	,325],
##[997	,939	,1153	,544	,0	,219	,507	,648	,869],
##[1046	,993	,947	,538	,219	,0	,458	,697	,863],
##[692	,466	,675	,71	,507	,458	,0	,372	,396],
##[349	,633	,961	,352	,648	,697	,372	,0	,326],
##[296	,324	,833	,325	,869	,863	,396	,326	,0]]

CITIES=['AB','A','AL','AV','BA','B','BI','BU','CC','CA','CS','CR','CO','C','CU','GE','GR','GU','H','HU','J','LE','L','LO','LU','M','MA','MU','OR','O','PA','PM','PO','SA','SS','S','SG','SE','SO','TA','TE','TO','V','VA','VI','ZA','Z']
KMt=[[0,171,369,366,525,540,646,488,504,617,256,207,354,860,142,640,363,309,506,495,264,584,515,578,762,251,473,150,772,702,491,598,874,463,691,644,338,492,473,443,242,240,191,444,602,499,423],
[171,0,294,537,696,515,817,659,675,688,231,378,525,1031,313,615,353,480,703,570,415,855,490,653,933,422,482,75,943,873,662,673,1045,634,766,815,509,609,548,417,317,411,166,615,739,670,498],
[369,294,0,663,604,809,958,800,651,484,525,407,332,1172,511,909,166,621,516,830,228,896,802,899,1074,563,219,219,1084,1014,803,970,1186,763,1032,956,650,422,794,711,577,526,460,756,914,811,758],
[366,537,663,0,318,717,401,243,229,618,532,256,457,538,282,817,534,173,552,490,435,255,558,358,440,115,644,516,443,373,168,437,545,97,475,369,67,493,261,649,417,137,467,121,357,159,418],
[525,696,604,318,0,1022,694,536,89,342,805,318,272,772,555,1122,438,459,251,798,376,496,866,676,674,401,436,675,645,614,461,755,747,299,768,662,385,217,579,935,703,368,716,414,650,361,726],
[540,515,809,717,1022,0,620,583,918,1284,284,811,908,1118,562,100,868,563,1140,274,804,784,156,468,1020,621,997,590,1027,902,669,437,1129,778,529,693,650,1046,453,98,409,692,349,663,530,759,296],
[646,817,958,401,694,620,0,158,605,1058,607,585,795,644,562,720,829,396,939,322,730,359,464,152,546,395,939,796,605,304,244,159,707,395,119,108,355,993,257,555,488,466,633,280,66,376,324],
[488,659,800,243,536,583,158,0,447,900,524,427,637,535,404,683,671,238,781,359,572,201,427,115,437,237,781,638,447,322,86,203,549,237,232,156,197,775,141,518,372,308,517,122,114,218,287],
[504,675,651,229,89,918,605,447,0,369,701,324,319,683,451,1018,485,355,323,694,423,407,762,595,585,297,506,654,556,525,372,650,658,210,679,573,296,264,490,831,599,264,636,325,561,272,622],
[617,688,484,618,342,1284,1058,900,369,0,873,464,263,1072,708,1384,335,721,219,1060,367,796,1128,999,974,663,265,613,945,914,761,1070,1047,599,1132,1056,750,125,894,1059,873,583,808,714,1014,661,988],
[256,231,525,532,805,284,607,524,701,873,0,463,610,1026,305,384,584,396,856,355,520,725,259,455,928,417,713,306,938,868,596,458,1040,629,551,680,504,762,383,186,152,437,65,563,574,665,283],
[207,378,407,256,318,811,585,427,324,464,463,0,201,799,244,911,278,248,433,587,179,511,655,526,696,190,388,357,699,641,424,597,701,353,659,583,277,339,421,649,397,119,398,377,541,415,515],
[354,525,332,457,272,908,795,637,319,263,610,201,0,995,445,1008,166,458,232,797,104,733,865,736,897,400,187,444,921,851,640,807,977,529,869,793,497,138,631,796,596,320,545,578,751,616,725],
[860,1031,1172,538,772,1118,644,535,683,1072,1026,799,995,0,776,1218,1043,667,1006,905,944,334,973,650,98,609,1153,1010,175,340,450,738,121,473,763,547,560,947,676,1064,907,675,961,455,549,411,833],
[142,313,511,282,555,562,562,404,451,708,305,244,445,776,0,662,479,486,677,406,380,500,472,464,678,167,615,292,689,618,407,535,791,379,636,560,254,583,359,464,153,187,220,360,518,415,334],
[640,615,909,817,1122,100,720,683,1018,1384,384,911,1008,1218,662,0,968,663,1240,374,904,884,256,568,1120,721,1097,690,1127,1002,769,537,1229,878,629,793,750,1146,553,198,509,792,449,763,630,859,396],
[363,353,166,534,438,868,829,671,485,335,584,278,166,1043,479,968,0,492,350,831,99,761,861,770,945,434,129,278,955,885,674,841,1058,631,903,827,521,256,665,770,605,397,519,627,785,682,759],
[309,480,621,173,459,563,396,238,355,721,396,248,458,667,486,663,492,0,690,339,393,391,407,278,569,58,602,459,579,509,298,349,681,270,441,394,145,596,173,476,244,129,410,251,352,306,267],
[506,703,516,552,251,1140,939,781,323,219,856,433,232,1006,677,1240,350,690,0,1029,336,730,1097,968,908,632,313,628,879,821,695,1039,981,533,1101,962,619,94,863,1029,842,552,791,648,919,595,957],
[495,570,830,490,798,274,322,359,694,1060,355,587,797,905,406,374,831,339,1029,0,732,560,118,244,807,397,941,611,803,626,442,163,905,554,255,430,426,935,229,209,253,468,398,439,256,535,72],
[264,415,228,435,376,804,730,572,423,367,520,179,104,944,380,904,99,393,336,732,0,668,779,671,846,335,209,340,856,786,575,742,957,532,804,728,422,242,566,707,506,298,455,528,686,583,660],
[584,855,896,255,496,784,359,201,407,796,725,511,733,334,500,884,761,391,730,560,668,0,628,316,236,333,877,734,271,118,130,404,373,197,433,293,245,671,342,719,573,392,685,134,315,135,488],
[515,490,802,558,866,156,464,427,762,1128,259,655,865,973,472,256,861,407,1097,118,779,628,0,312,875,465,1009,583,871,703,513,281,973,622,373,537,494,1003,297,91,319,536,324,507,374,603,140],
[578,653,899,358,676,468,152,115,595,999,455,526,736,650,464,568,770,278,968,244,671,316,312,0,352,336,880,694,562,391,201,88,664,352,169,225,299,874,105,403,336,407,481,237,86,333,172],
[762,933,1074,440,674,1020,546,437,585,974,928,696,897,98,678,1120,945,569,908,807,846,236,875,352,0,511,1055,912,95,242,352,640,148,375,665,449,462,849,578,966,809,577,863,357,451,313,735],
[251,422,563,115,401,621,395,237,297,663,417,190,400,609,167,721,434,58,632,397,335,333,465,336,511,0,544,401,521,451,240,407,623,212,469,393,87,538,231,534,302,71,352,193,351,248,325],
[473,482,219,644,436,997,939,781,506,265,713,388,187,1153,615,1097,129,602,313,941,209,877,1009,880,1055,544,0,407,1065,995,784,951,1153,756,1013,937,631,219,775,899,715,507,648,737,895,792,869],
[150,75,219,516,675,590,796,638,654,613,306,357,444,1010,292,690,278,459,628,611,340,734,583,694,912,401,407,0,922,852,641,714,1024,613,807,794,488,534,589,492,385,390,241,594,752,649,539],
[772,943,1084,443,645,1027,605,447,556,945,938,699,921,175,689,1127,955,579,879,803,856,271,871,562,95,521,1065,922,0,337,361,650,102,346,679,544,467,820,574,962,805,580,873,356,561,284,731],
[702,873,1014,373,614,902,304,322,525,914,868,641,851,340,618,1002,885,509,821,626,786,118,703,391,242,451,995,852,337,0,248,463,390,315,423,207,363,789,463,835,694,510,803,252,340,253,604],
[491,662,803,168,461,669,244,86,372,761,596,424,640,450,407,769,674,298,695,442,575,130,513,201,352,240,784,641,361,248,0,289,463,162,318,201,158,636,213,604,444,305,592,47,200,143,373],
[598,673,970,437,755,437,159,203,650,1070,458,597,807,738,535,537,841,349,1039,163,742,404,281,88,640,407,951,714,650,463,289,0,752,440,92,267,370,945,176,372,356,478,501,325,93,421,175],
[874,1045,1186,545,747,1129,707,549,658,1047,1040,701,977,121,791,1229,1058,681,981,905,957,373,973,664,148,623,1153,1024,102,390,463,752,0,448,781,666,569,922,676,1064,907,682,975,458,663,386,833],
[463,634,763,97,299,778,395,237,210,599,629,353,529,473,379,878,631,270,533,554,532,197,622,352,375,212,756,613,346,315,162,440,448,0,469,363,164,474,325,713,514,234,564,115,351,62,482],
[691,766,1032,475,768,529,119,232,679,1132,551,659,869,763,636,629,903,441,1101,255,804,433,373,169,665,469,1013,807,679,423,318,92,781,469,0,227,429,1007,268,464,449,540,594,354,118,450,268],
[644,815,956,369,662,693,108,156,573,1056,680,583,793,547,560,793,827,394,962,430,728,293,537,225,449,393,937,794,544,207,201,267,666,363,227,0,359,837,297,628,528,464,673,248,174,344,397],
[338,509,650,67,385,650,355,197,296,750,504,277,497,560,254,750,521,145,619,426,422,245,494,299,462,87,631,488,467,363,158,370,569,164,429,359,0,560,194,585,389,158,439,111,311,182,354],
[492,609,422,493,217,1046,993,775,264,125,762,339,138,947,583,1146,256,596,94,935,242,671,1003,874,849,538,219,534,820,789,636,945,922,474,1007,837,560,0,769,949,748,458,697,589,825,536,863],
[473,548,794,261,579,453,257,141,490,894,383,421,631,676,359,553,665,173,863,229,566,342,297,105,578,231,775,589,574,463,213,176,676,325,268,297,194,769,0,388,231,302,376,210,191,306,157],
[443,417,711,649,935,98,555,518,831,1059,186,649,796,1064,464,198,770,476,1029,209,707,719,91,403,966,534,899,492,962,835,604,372,1064,713,464,628,585,949,388,0,311,605,251,598,489,694,231],
[242,317,577,417,703,409,488,372,599,873,152,397,596,907,153,509,605,244,842,253,506,573,319,336,809,302,715,385,805,694,444,356,907,514,449,528,389,748,231,311,0,340,145,441,422,537,181],
[240,411,526,137,368,692,466,308,264,583,437,119,320,675,187,792,397,129,552,468,298,392,536,407,577,71,507,390,580,510,305,478,682,234,540,464,158,458,302,605,340,0,372,258,422,296,396],
[191,166,460,467,716,349,633,517,636,808,65,398,545,961,220,449,519,410,791,398,455,685,324,481,863,352,648,241,873,803,592,501,975,564,594,673,439,697,376,251,145,372,0,545,576,600,326],
[444,615,756,121,414,663,280,122,325,714,563,377,578,455,360,763,627,251,648,439,528,134,507,237,357,193,737,594,356,252,47,325,458,115,354,248,111,589,210,598,441,258,545,0,236,96,367],
[602,739,914,357,650,530,66,114,561,1014,574,541,751,549,518,630,785,352,919,256,686,315,374,86,451,351,895,752,561,340,200,93,663,351,118,174,311,825,191,489,422,422,576,236,0,332,258],
[499,670,811,159,361,759,376,218,272,661,665,415,616,411,415,859,682,306,595,535,583,135,603,333,313,248,792,649,284,253,143,421,386,62,450,344,182,536,306,694,537,296,600,96,332,0,463],
[423,498,758,418,726,296,324,287,622,988,283,515,725,833,334,396,759,267,957,72,660,488,140,172,735,325,869,539,731,604,373,175,833,482,268,397,354,863,157,231,181,396,326,367,258,463,0]]



def KMt_to_KMd(KMt):
    ## Toledo-Barcelona KMd['TO','B'] --> 692km
    KMd={}
    for city1 in CITIES:
        for city2 in CITIES:
            KMd[city1,city2]=KMt[CITIES.index(city1)][CITIES.index(city2)]
    return KMd

def suffle(lCities):
    res=lCities
    top=len(lCities)
    for i in range(top):
        dice=randint(0,top-1)
        res[i],res[dice]=res[dice],res[i]
    return res
    
def pathLen(lCities):
    km=0
    top=len(lCities)
    for i in range(top-1):
        km+=KMd[lCities[i],lCities[i+1]]
    #y conecto última con primera, cerrando el círculo
    km+=KMd[lCities[top-1],lCities[0]]
    return km
    
def mejorarPathLen(lCities):
    res=lCities[:]
    top=len(res)
    dice1=randint(0,top-1)
    dice2=randint(0,top-1)
    res[dice1],res[dice2]=res[dice2],res[dice1]
    if pathLen(res)<pathLen(lCities):
        return res
    else:
        return lCities
    
CASOS=5000
INTENTOS=8000
KMd=KMt_to_KMd(KMt)
for i in range(CASOS):
    randomCombo=suffle(CITIES)
    #print randomCombo,pathLen(randomCombo)
    for j in range(INTENTOS):
        betterCombo=mejorarPathLen(randomCombo)
        randomCombo=betterCombo[:]
    if pathLen(randomCombo)<8000:  ## 6700
        print(randomCombo,pathLen(randomCombo))
        
## Some good finds
##['AV', 'SA', 'ZA', 'OR', 'PO', 'C', 'LU', 'O', 'LE', 'SG', 'GU', 'M', 'TO', 'CU', 'AB', 'A', 'MU', 'AL', 'GR', 'MA', 'J', 'CR', 'VA', 'PA', 'BU', 'S', 'BI', 'SS', 'VI', 'LO', 'SO', 'PM', 'HU', 'L', 'B', 'GE', 'TA', 'CS', 'V', 'TE', 'Z', 'CO', 'CA', 'SE', 'H', 'BA', 'CC'] 7586
##['LE', 'PA', 'VA', 'SA', 'CC', 'BA', 'CO', 'SE', 'H', 'CA', 'MA', 'AB', 'CU', 'V', 'CS', 'A', 'MU', 'AL', 'GR', 'J', 'CR', 'TO', 'M', 'GU', 'TE', 'TA', 'GE', 'B', 'L', 'HU', 'Z', 'PM', 'SS', 'S', 'BI', 'VI', 'LO', 'SO', 'BU', 'AV', 'SG', 'O', 'LU', 'C', 'PO', 'OR', 'ZA'] 7550
##['H', 'SE', 'CA', 'CO', 'CR', 'TO', 'CU', 'TE', 'V', 'AB', 'J', 'GR', 'MA', 'AL', 'MU', 'A', 'CS', 'TA', 'L', 'SO', 'GU', 'M', 'AV', 'SG', 'VA', 'S', 'BI', 'VI', 'SS', 'PM', 'B', 'GE', 'HU', 'Z', 'LO', 'BU', 'PA', 'LE', 'O', 'LU', 'C', 'PO', 'OR', 'ZA', 'SA', 'CC', 'BA'] 7507
##['J', 'AL', 'GR', 'MA', 'CO', 'CA', 'H', 'SE', 'BA', 'CC', 'AV', 'BI', 'VI', 'S', 'O', 'C', 'PO', 'OR', 'LU', 'LE', 'ZA', 'SA', 'CU', 'AB', 'MU', 'A', 'V', 'TE', 'CS', 'TA', 'GE', 'B', 'L', 'HU', 'PM', 'SS', 'LO', 'Z', 'SO', 'BU', 'PA', 'VA', 'SG', 'GU', 'M', 'TO', 'CR'] 7437
##['SG', 'VA', 'S', 'BI', 'SS', 'LO', 'SO', 'GU', 'M', 'TO', 'CU', 'AB', 'J', 'CO', 'GR', 'CR', 'AV', 'SA', 'CC', 'BA', 'SE', 'H', 'CA', 'MA', 'AL', 'MU', 'A', 'V', 'CS', 'TA', 'B', 'GE', 'L', 'HU', 'TE', 'Z', 'PM', 'VI', 'BU', 'PA', 'LE', 'O', 'LU', 'C', 'PO', 'OR', 'ZA'] 7431
##['CS', 'TA', 'B', 'GE', 'L', 'HU', 'PM', 'SS', 'BI', 'VI', 'S', 'O', 'C', 'PO', 'OR', 'LU', 'LE', 'PA', 'SO', 'GU', 'M', 'SG', 'VA', 'ZA', 'SA', 'AV', 'CC', 'BA', 'CO', 'H', 'SE', 'CA', 'MA', 'AL', 'MU', 'GR', 'J', 'CR', 'TO', 'BU', 'LO', 'Z', 'TE', 'CU', 'AB', 'A', 'V'] 7392
##['OR', 'ZA', 'SA', 'BA', 'CC', 'TO', 'CR', 'CO', 'H', 'SE', 'CA', 'MA', 'AL', 'GR', 'J', 'AB', 'V', 'CS', 'A', 'MU', 'CU', 'TE', 'Z', 'HU', 'TA', 'GE', 'B', 'L', 'SO', 'LO', 'VI', 'PM', 'SS', 'BI', 'S', 'BU', 'PA', 'SG', 'GU', 'M', 'AV', 'VA', 'LE', 'O', 'LU', 'PO', 'C'] 7382
##['C', 'LU', 'SG', 'CR', 'J', 'CO', 'SE', 'H', 'CA', 'MA', 'GR', 'AL', 'AB', 'MU', 'A', 'V', 'CS', 'TA', 'B', 'GE', 'L', 'HU', 'Z', 'TE', 'CU', 'M', 'GU', 'TO', 'AV', 'BA', 'CC', 'SA', 'ZA', 'LE', 'O', 'S', 'BI', 'VI', 'SS', 'PM', 'LO', 'SO', 'BU', 'PA', 'VA', 'OR', 'PO'] 7180
##['VA', 'PA', 'ZA', 'OR', 'PO', 'C', 'LU', 'O', 'LE', 'AV', 'SG', 'M', 'TO', 'CU', 'TE', 'Z', 'HU', 'GU', 'SO', 'LO', 'PM', 'SS', 'VI', 'BI', 'S', 'BU', 'L', 'B', 'GE', 'TA', 'CS', 'V', 'A', 'MU', 'AB', 'CR', 'CO', 'J', 'GR', 'AL', 'MA', 'CA', 'SE', 'H', 'BA', 'CC', 'SA'] 7141
##['TA', 'CS', 'V', 'A', 'MU', 'AL', 'GR', 'CR', 'TO', 'M', 'GU', 'SG', 'BU', 'VI', 'SS', 'PM', 'Z', 'SO', 'LO', 'BI', 'S', 'PA', 'VA', 'ZA', 'LE', 'O', 'LU', 'C', 'PO', 'OR', 'SA', 'AV', 'CC', 'BA', 'H', 'SE', 'CA', 'MA', 'CO', 'J', 'AB', 'CU', 'TE', 'HU', 'L', 'B', 'GE'] 7097
##['LU', 'O', 'S', 'BI', 'SS', 'Z', 'HU', 'L', 'B', 'GE', 'TA', 'CS', 'V', 'A', 'MU', 'AB', 'TE', 'CU', 'SG', 'AV', 'M', 'GU', 'SO', 'LO', 'PM', 'VI', 'BU', 'PA', 'VA', 'ZA', 'SA', 'CC', 'BA', 'H', 'SE', 'CA', 'CO', 'MA', 'AL', 'GR', 'J', 'CR', 'TO', 'LE', 'OR', 'PO', 'C'] 6968
##['TO', 'M', 'GU', 'TE', 'A', 'MU', 'AL', 'GR', 'MA', 'CA', 'SE', 'H', 'J', 'CO', 'BA', 'CC', 'SA', 'ZA', 'LE', 'OR', 'PO', 'C', 'LU', 'O', 'S', 'BI', 'VI', 'SS', 'PM', 'LO', 'SO', 'BU', 'PA', 'VA', 'AV', 'SG', 'Z', 'HU', 'L', 'B', 'GE', 'TA', 'CS', 'V', 'CU', 'AB', 'CR'] 6988
##['GE', 'TA', 'CS', 'V', 'TE', 'CU', 'TO', 'GU', 'M', 'SG', 'AV', 'VA', 'LU', 'C', 'PO', 'OR', 'ZA', 'SA', 'CC', 'BA', 'H', 'SE', 'CA', 'MA', 'CO', 'CR', 'J', 'GR', 'AL', 'MU', 'A', 'AB', 'BU', 'PA', 'LE', 'O', 'S', 'BI', 'SS', 'PM', 'VI', 'LO', 'SO', 'Z', 'HU', 'L', 'B'] 6986
##['C', 'PO', 'OR', 'LE', 'PA', 'BU', 'S', 'BI', 'SS', 'VI', 'LO', 'PM', 'Z', 'HU', 'L', 'GE', 'B', 'TA', 'CS', 'TE', 'SO', 'GU', 'M', 'TO', 'CU', 'AB', 'V', 'A', 'MU', 'AL', 'MA', 'GR', 'J', 'CR', 'CO', 'CA', 'SE', 'H', 'BA', 'CC', 'SA', 'ZA', 'AV', 'SG', 'VA', 'O', 'LU'] 6905
##['GR', 'AL', 'MA', 'CO', 'SE', 'CA', 'H', 'BA', 'CC', 'SA', 'ZA', 'BU', 'SO', 'GU', 'M', 'TO', 'AV', 'SG', 'VA', 'PA', 'LE', 'OR', 'PO', 'C', 'LU', 'O', 'S', 'BI', 'SS', 'PM', 'VI', 'LO', 'Z', 'HU', 'L', 'GE', 'B', 'TA', 'A', 'MU', 'V', 'CS', 'TE', 'CU', 'AB', 'CR', 'J'] 6904
##['BA', 'CC', 'AV', 'SG', 'VA', 'PA', 'LE', 'O', 'LU', 'C', 'PO', 'OR', 'ZA', 'SA', 'M', 'CU', 'TE', 'V', 'CS', 'TA', 'B', 'GE', 'L', 'HU', 'Z', 'LO', 'VI', 'BU', 'S', 'BI', 'SS', 'PM', 'SO', 'GU', 'TO', 'CR', 'AB', 'A', 'MU', 'AL', 'GR', 'J', 'CO', 'MA', 'CA', 'SE', 'H'] 6679
